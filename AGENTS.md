**THESE RULES ONLY APPLY TO FILES IN /halos-core-containers/**

# HaLOS Core Containers - Development Guide

## For Agentic Coding: Use the HaLOS Workspace

This repository should be used as part of the halos-distro workspace for AI-assisted development:

```bash
# Clone workspace and all repos
git clone https://github.com/halos-org/halos-distro.git
cd halos-distro
./run repos:clone
```

See `halos-distro/docs/` for development workflows and guidance.

## About This Project

Core container application definitions for HaLOS. These apps are pre-installed in HaLOS images, not user-browsable through a store UI.

**Key difference from halos-marine-containers:** No `store/` directory - core apps are pre-installed, not discovered via store UI.

**Local Instructions**: For environment-specific instructions and configurations, see @CLAUDE.local.md (not committed to version control).

## Git Workflow Policy

**Branch Workflow:** Never push to main directly - always use feature branches and PRs.

**Link issues and PRs:** Always link related GitHub issues in PR descriptions with `Closes #<issue-number>`.

## Version Management

This repository uses the same versioning system as halos-marine-containers:

### VERSION File (Meta/Bundle Version)

The `VERSION` file is a **meta-version for git tags only**. It does NOT control Debian package versions.

- Used by CI to create git tags: `v{VERSION}+{N}_pre` and `v{VERSION}+{N}`
- Controls when new releases are triggered
- Bump this when you want a new release bundle

### App Package Versions

Individual apps in `apps/` have their own versions in `metadata.yaml`. These are independent of the VERSION file.

### Git Tags (auto-generated by CI)

- Pre-release: `v{VERSION}+{N}_pre` (unstable channel)
- Stable: `v{VERSION}+{N}` (stable channel)
- N = auto-calculated from existing git tags

**CI Enforcement**: PRs that change app files in `apps/<app>/` must include a bump to the `version` field in `apps/<app>/metadata.yaml`, or CI will fail. Changes outside `apps/` that affect the package also require a VERSION file bump.

## What This Repository Contains

**Container app definitions only** - no store package:
- **Core Apps** (`apps/`) - Pre-installed HaLOS applications
  - Homarr dashboard (main landing page)
  - Future: Traefik reverse proxy

## Repository Structure

```
halos-core-containers/
├── apps/
│   └── homarr/
│       ├── docker-compose.yml
│       ├── config.yml
│       ├── metadata.yaml
│       └── icon.png
├── tools/
│   └── build-all.sh         # Build all packages
├── .github/workflows/
│   └── main.yml             # CI/CD
└── README.md
```

## Adding a New Core App

1. Create `apps/<app-name>/` directory
2. Add `docker-compose.yml`, `config.yml`, `metadata.yaml`, `icon.png`
3. Test locally with `generate-container-packages`
4. Create PR - CI will build and validate

### App Definition Files

- **metadata.yaml**: Package info, version, description, tags (must include `field::core`)
- **docker-compose.yml**: Docker service definition
- **config.yml**: User-configurable settings (optional)
- **icon.png**: Application icon (256x256, PNG format)

## Building

**Requirements**: `container-packaging-tools` installed

```bash
# Build all packages
./tools/build-all.sh

# Output: build/*.deb
```

**CI/CD**: GitHub Actions builds on push and creates releases.

## Related

- **Parent**: [../AGENTS.md](../AGENTS.md) - Workspace documentation
- **Sibling**: [halos-marine-containers](https://github.com/halos-org/halos-marine-containers) - Marine container store
- **Tooling**: [container-packaging-tools](https://github.com/halos-org/container-packaging-tools)
